<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CSS: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CSS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CSS Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="d6/ded/namespaceCSS.html">CSS</a> (A <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> parser and minifier written in PHP)</p>
<hr  />
<p><a href="https://github.com/tbela99/css/actions/workflows/php.yml"><object type="image/svg+xml" data="https://github.com/tbela99/css/actions/workflows/php.yml/badge.svg" style="pointer-events: none;">CI</object></a> <img src="https://img.shields.io/badge/dynamic/json?label=current%20version&amp;query=version&amp;url=https%3A%2F%2Fraw.githubusercontent.com%2Ftbela99%2Fcss%2Fmaster%2Fpackage.json" alt="Current version" class="inline"/> <a href="https://packagist.org/packages/tbela99/css"><img src="https://poser.pugx.org/tbela99/css/downloads" alt="Packagist" class="inline"/></a> <a href="https://tbela99.github.io/css"><img src="https://img.shields.io/badge/dynamic/json?label=documentation&amp;query=version&amp;url=https%3A%2F%2Fraw.githubusercontent.com%2Ftbela99%2Fcss%2Fmaster%2Fpackage.json" alt="Documentation" class="inline"/></a> <a href="https://snyk.io/test/github/tbela99/css"><object type="image/svg+xml" data="https://snyk.io/test/github/tbela99/gzip/badge.svg" style="pointer-events: none;">Known Vulnerabilities</object></a></p>
<p>A <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> parser, beautifier and minifier written in PHP. It supports the following features</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Features</h2>
<ul>
<li>multibyte characters encoding</li>
<li>sourcemap</li>
<li>multiprocessing: process large <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> input very fast</li>
<li><a class="el" href="d6/ded/namespaceCSS.html">CSS</a> Nesting module</li>
<li>partially implemented <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> Syntax module level 3</li>
<li>partial <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> validation</li>
<li><a class="el" href="d6/ded/namespaceCSS.html">CSS</a> colors module level 4</li>
<li>parse and render <a class="el" href="d6/ded/namespaceCSS.html">CSS</a></li>
<li>optimize css:<ul>
<li>merge duplicate rules</li>
<li>remove duplicate declarations</li>
<li>remove empty rules</li>
<li>compute css shorthand (margin, padding, outline, border-radius, font, background)</li>
<li>process @import document to reduce the number of HTTP requests</li>
<li>remove @charset directive</li>
</ul>
</li>
<li>query api with xpath like or class name syntax</li>
<li>traverser api to transform the css and ast</li>
<li>command line utility</li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Installation</h2>
<p>install using <a href="https://getcomposer.org/">Composer</a></p>
<div class="fragment"><div class="line">$ composer require tbela99/css</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Requirements</h2>
<ul>
<li>PHP version &gt;= 8.0 on master branch.</li>
<li>PHP version &gt;= 5.6 supported in <a href="https://github.com/tbela99/css/tree/php56-backport">this branch</a></li>
<li>mbstring extension</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Usage:</h2>
<div class="fragment"><div class="line">h1 {</div>
<div class="line">  color: green;</div>
<div class="line">  color: blue;</div>
<div class="line">  color: black;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">h1 {</div>
<div class="line">  color: #000;</div>
<div class="line">  color: aliceblue;</div>
<div class="line">}</div>
</div><!-- fragment --><p>PHP Code</p>
<div class="fragment"><div class="line">use \TBela\CSS\Parser;</div>
<div class="line"> </div>
<div class="line">$parser = <span class="keyword">new</span> Parser();</div>
<div class="line"> </div>
<div class="line">$parser-&gt;setContent(<span class="stringliteral">&#39;</span></div>
<div class="line"><span class="stringliteral">h1 {</span></div>
<div class="line"><span class="stringliteral">  color: green;</span></div>
<div class="line"><span class="stringliteral">  color: blue;</span></div>
<div class="line"><span class="stringliteral">  color: black;</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">h1 {</span></div>
<div class="line"><span class="stringliteral">  color: #000;</span></div>
<div class="line"><span class="stringliteral">  color: aliceblue;</span></div>
<div class="line"><span class="stringliteral">}&#39;</span>);</div>
<div class="line"> </div>
<div class="line">echo $parser-&gt;parse();</div>
</div><!-- fragment --><p>Result</p>
<div class="fragment"><div class="line">h1 {</div>
<div class="line">  color: #f0f8ff;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Parse the css file and generate the AST</p>
<div class="fragment"><div class="line">use \TBela\CSS\Parser;</div>
<div class="line">use \TBela\CSS\Renderer;</div>
<div class="line"> </div>
<div class="line">$parser = <span class="keyword">new</span> Parser($css);</div>
<div class="line">$element = $parser-&gt;parse();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// append an existing css file</span></div>
<div class="line">$parser-&gt;append(<span class="stringliteral">&#39;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// append css string</span></div>
<div class="line">$parser-&gt;appendContent($css_string);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// pretty print css</span></div>
<div class="line">$css = (string) $element;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// minified output</span></div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer([</div>
<div class="line">  <span class="stringliteral">&#39;compress&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line">  <span class="stringliteral">&#39;convert_color&#39;</span> =&gt; <span class="stringliteral">&#39;hex&#39;</span>,</div>
<div class="line">  <span class="stringliteral">&#39;css_level&#39;</span> =&gt; 4,</div>
<div class="line">  <span class="stringliteral">&#39;sourcemap&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line">  <span class="stringliteral">&#39;allow_duplicate_declarations&#39;</span> =&gt; <span class="keyword">false</span></div>
<div class="line">  ]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// fast</span></div>
<div class="line">$css = $renderer-&gt;renderAst($parser);</div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">$css = $renderer-&gt;renderAst($parser-&gt;getAst());</div>
<div class="line"><span class="comment">// slow</span></div>
<div class="line">$css = $renderer-&gt;render($element);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// generate sourcemap -&gt; css/all.css.map</span></div>
<div class="line">$renderer-&gt;save($element, <span class="stringliteral">&#39;css/all.css&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// save as json</span></div>
<div class="line">file_put_contents(<span class="stringliteral">&#39;style.json&#39;</span>, json_encode($element));</div>
</div><!-- fragment --><p>Load the AST and generate css code</p>
<div class="fragment"><div class="line">use \TBela\CSS\Renderer;</div>
<div class="line"><span class="comment">// fastest way to render css</span></div>
<div class="line">$beautify = (<span class="keyword">new</span> Renderer())-&gt;renderAst($parser-&gt;setContent($css)-&gt;getAst());</div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">$beautify = (<span class="keyword">new</span> Renderer())-&gt;renderAst($parser-&gt;setContent($css));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// or</span></div>
<div class="line">$css = (<span class="keyword">new</span> Renderer())-&gt;renderAst(json_decode(file_get_contents(<span class="stringliteral">&#39;style.json&#39;</span>)));</div>
</div><!-- fragment --><div class="fragment"><div class="line">use \TBela\CSS\Renderer;</div>
<div class="line"> </div>
<div class="line">$ast = json_decode(file_get_contents(<span class="stringliteral">&#39;style.json&#39;</span>));</div>
<div class="line"> </div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer([</div>
<div class="line">    <span class="stringliteral">&#39;convert_color&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line">    <span class="stringliteral">&#39;compress&#39;</span> =&gt; <span class="keyword">true</span>, <span class="comment">// minify the output</span></div>
<div class="line">    <span class="stringliteral">&#39;remove_empty_nodes&#39;</span> =&gt; <span class="keyword">true</span> <span class="comment">// remove empty css classes</span></div>
<div class="line">]);</div>
<div class="line"> </div>
<div class="line">$css = $renderer-&gt;renderAst($ast);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Sourcemap generation</h2>
<div class="fragment"><div class="line">$renderer = <span class="keyword">new</span> Renderer([</div>
<div class="line">  <span class="stringliteral">&#39;sourcemap&#39;</span> =&gt; <span class="keyword">true</span></div>
<div class="line">  ]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// call save and specify the file name</span></div>
<div class="line"><span class="comment">// generate sourcemap -&gt; css/all.css.map</span></div>
<div class="line">$renderer-&gt;save($element, <span class="stringliteral">&#39;css/all.css&#39;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
The CSS Query API</h2>
<p>Example: get all background and background-image declarations that contain an image url</p>
<div class="fragment"><div class="line">$element = Element::fromUrl(<span class="stringliteral">&#39;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> ($element-&gt;query(<span class="stringliteral">&#39;[@name=background][@value*=&quot;url(&quot;]|[@name=background-image][@value*=&quot;url(&quot;]&#39;</span>) as $p) {</div>
<div class="line"> </div>
<div class="line">    echo <span class="stringliteral">&quot;$p\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>result</p>
<div class="fragment"><div class="line">.form-select {</div>
<div class="line"> background-image: url(&quot;data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 16 16&#39;%3e%3cpath fill=&#39;none&#39; stroke=&#39;%23343a40&#39; stroke-linecap=&#39;round&#39; stroke-linejoin=&#39;round&#39; stroke-width=&#39;2&#39; d=&#39;M2 5l6 6 6-6&#39;/%3e%3c</div>
<div class="line">/svg%3e&quot;)</div>
<div class="line">}</div>
<div class="line">.form-check-input:checked[type=checkbox] {</div>
<div class="line"> background-image: url(&quot;data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 20 20&#39;%3e%3cpath fill=&#39;none&#39; stroke=&#39;%23fff&#39; stroke-linecap=&#39;round&#39; stroke-linejoin=&#39;round&#39; stroke-width=&#39;3&#39; d=&#39;M6 10l3 3l6-6&#39;/%3e%3c/s</div>
<div class="line">vg%3e&quot;)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">...</div>
</div><!-- fragment --><p>Example: Extract Font-src declaration</p>
<p><a class="el" href="d6/ded/namespaceCSS.html">CSS</a> source</p>
<div class="fragment"><div class="line">@font-face {</div>
<div class="line">  font-family: &quot;Bitstream Vera Serif Bold&quot;;</div>
<div class="line">  src: url(&quot;/static/styles/libs/font-awesome/fonts/fontawesome-webfont.fdf491ce5ff5.woff&quot;);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">body {</div>
<div class="line">  background-color: green;</div>
<div class="line">  color: #fff;</div>
<div class="line">  font-family: Arial, Helvetica, sans-serif;</div>
<div class="line">}</div>
<div class="line">h1 {</div>
<div class="line">  color: #fff;</div>
<div class="line">  font-size: 50px;</div>
<div class="line">  font-family: Arial, Helvetica, sans-serif;</div>
<div class="line">  font-weight: bold;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">@media print {</div>
<div class="line">  @font-face {</div>
<div class="line">    font-family: MaHelvetica;</div>
<div class="line">    src: local(&quot;Helvetica Neue Bold&quot;), local(&quot;HelveticaNeue-Bold&quot;),</div>
<div class="line">      url(MgOpenModernaBold.ttf);</div>
<div class="line">    font-weight: bold;</div>
<div class="line">  }</div>
<div class="line">  body {</div>
<div class="line">    font-family: &quot;Bitstream Vera Serif Bold&quot;, serif;</div>
<div class="line">  }</div>
<div class="line">  p {</div>
<div class="line">    font-size: 12px;</div>
<div class="line">    color: #000;</div>
<div class="line">    text-align: left;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  @font-face {</div>
<div class="line">    font-family: Arial, MaHelvetica;</div>
<div class="line">    src: local(&quot;Helvetica Neue Bold&quot;), local(&quot;HelveticaNeue-Bold&quot;),</div>
<div class="line">      url(MgOpenModernaBold.ttf);</div>
<div class="line">    font-weight: bold;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>PHP source</p>
<div class="fragment"><div class="line">use \TBela\CSS\Parser;</div>
<div class="line"> </div>
<div class="line">$parser = <span class="keyword">new</span> Parser();</div>
<div class="line"> </div>
<div class="line">$parser-&gt;setContent($css);</div>
<div class="line"> </div>
<div class="line">$stylesheet = $parser-&gt;parse();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// get @font-face nodes by class names</span></div>
<div class="line">$nodes = $stylesheet-&gt;queryByClassNames(<span class="stringliteral">&#39;@font-face, .foo .bar&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// or</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// get all src properties in a @font-face rule</span></div>
<div class="line">$nodes = $stylesheet-&gt;query(<span class="stringliteral">&#39;@font-face/src&#39;</span>);</div>
<div class="line"> </div>
<div class="line">echo implode(<span class="stringliteral">&quot;\n&quot;</span>, array_map(<span class="stringliteral">&#39;trim&#39;</span>, $nodes));</div>
</div><!-- fragment --><p>result</p>
<div class="fragment"><div class="line">@font-face {</div>
<div class="line">  src: url(&quot;/static/styles/libs/font-awesome/fonts/fontawesome-webfont.fdf491ce5ff5.woff&quot;);</div>
<div class="line">}</div>
<div class="line">@media print {</div>
<div class="line">  @font-face {</div>
<div class="line">    src: local(&quot;Helvetica Neue Bold&quot;), local(&quot;HelveticaNeue-Bold&quot;),</div>
<div class="line">      url(MgOpenModernaBold.ttf);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">@media print {</div>
<div class="line">  @font-face {</div>
<div class="line">    src: local(&quot;Helvetica Neue Bold&quot;), local(&quot;HelveticaNeue-Bold&quot;),</div>
<div class="line">      url(MgOpenModernaBold.ttf);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>render optimized css</p>
<div class="fragment"><div class="line">$stylesheet-&gt;setChildren(array_map(<span class="keyword">function</span> ($node) { <span class="keywordflow">return</span> $node-&gt;copy()-&gt;getRoot(); }, $nodes));</div>
<div class="line">$stylesheet-&gt;deduplicate();</div>
<div class="line"> </div>
<div class="line">echo $stylesheet;</div>
</div><!-- fragment --><p>result</p>
<div class="fragment"><div class="line">@font-face {</div>
<div class="line">  src: url(/static/styles/libs/font-awesome/fonts/fontawesome-webfont.fdf491ce5ff5.woff)</div>
<div class="line">}</div>
<div class="line">@media print {</div>
<div class="line"> @font-face {</div>
<div class="line">   src: local(&quot;Helvetica Neue Bold&quot;), local(HelveticaNeue-Bold), url(MgOpenModernaBold.ttf)</div>
<div class="line"> }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
CSS Nesting</h2>
<div class="fragment"><div class="line">table.colortable {</div>
<div class="line">  &amp; td {</div>
<div class="line">    text-align:center;</div>
<div class="line">    &amp;.c { text-transform:uppercase }</div>
<div class="line">    &amp;:first-child, &amp;:first-child + td { border:1px solid black }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">&amp; th {</div>
<div class="line">text-align:center;</div>
<div class="line">background:black;</div>
<div class="line">color:white;</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p>render <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> nesting</p>
<div class="fragment"><div class="line">use <a class="code" href="d8/d8b/classTBela_1_1CSS_1_1Parser.html">TBela\CSS\Parser</a>;</div>
<div class="line"> </div>
<div class="line">echo <span class="keyword">new</span> Parser($css);</div>
</div><!-- fragment --><p>result</p>
<div class="fragment"><div class="line">table.colortable {</div>
<div class="line"> &amp; td {</div>
<div class="line">  text-align: center;</div>
<div class="line">  &amp;.c {</div>
<div class="line">   text-transform: uppercase</div>
<div class="line">  }</div>
<div class="line">  &amp;:first-child,</div>
<div class="line">  &amp;:first-child+td {</div>
<div class="line">   border: 1px solid #000</div>
<div class="line">  }</div>
<div class="line"> }</div>
<div class="line"> &amp; th {</div>
<div class="line">  text-align: center;</div>
<div class="line">  background: #000;</div>
<div class="line">  color: #fff</div>
<div class="line"> }</div>
<div class="line">}</div>
</div><!-- fragment --><p>convert nesting <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> to older representation</p>
<div class="fragment"><div class="line">use <a class="code" href="d8/d8b/classTBela_1_1CSS_1_1Parser.html">TBela\CSS\Parser</a>;</div>
<div class="line">use \TBela\CSS\Renderer;</div>
<div class="line"> </div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer( [<span class="stringliteral">&#39;legacy_rendering&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line">echo $renderer-&gt;renderAst(<span class="keyword">new</span> Parser($css));</div>
</div><!-- fragment --><p>result</p>
<div class="fragment"><div class="line">table.colortable td {</div>
<div class="line"> text-align: center</div>
<div class="line">}</div>
<div class="line">table.colortable td.c {</div>
<div class="line"> text-transform: uppercase</div>
<div class="line">}</div>
<div class="line">table.colortable td:first-child,</div>
<div class="line">table.colortable td:first-child+td {</div>
<div class="line"> border: 1px solid #000</div>
<div class="line">}</div>
<div class="line">table.colortable th {</div>
<div class="line"> text-align: center;</div>
<div class="line"> background: #000;</div>
<div class="line"> color: #fff</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
The Traverser Api</h2>
<p>The traverser will iterate over all the nodes and process them with the callbacks provided. It will return a new tree Example using ast</p>
<div class="fragment"><div class="line">use <a class="code" href="dd/df5/classTBela_1_1CSS_1_1Ast_1_1Traverser.html">TBela\CSS\Ast\Traverser</a>;</div>
<div class="line">use <a class="code" href="d8/d8b/classTBela_1_1CSS_1_1Parser.html">TBela\CSS\Parser</a>;</div>
<div class="line">use <a class="code" href="df/d08/classTBela_1_1CSS_1_1Renderer.html">TBela\CSS\Renderer</a>;</div>
<div class="line"> </div>
<div class="line">$parser = (<span class="keyword">new</span> Parser())-&gt;load(<span class="stringliteral">&#39;ast/media.css&#39;</span>);</div>
<div class="line">$traverser = <span class="keyword">new</span> Traverser();</div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer([<span class="stringliteral">&#39;remove_empty_nodes&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line"> </div>
<div class="line">$ast = $parser-&gt;getAst();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// remove @media print</span></div>
<div class="line">$traverser-&gt;on(<span class="stringliteral">&#39;enter&#39;</span>, <span class="keyword">function</span> ($node) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ($node-&gt;type == <span class="stringliteral">&#39;AtRule&#39;</span> &amp;&amp; $node-&gt;name == <span class="stringliteral">&#39;media&#39;</span> &amp;&amp; $node-&gt;value == <span class="stringliteral">&#39;print&#39;</span>) {</div>
<div class="line"> </div>
<div class="line">        return Traverser::IGNORE_NODE;</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">$newAst = $traverser-&gt;traverse($ast);</div>
<div class="line">echo $renderer-&gt;renderAst($newAst);</div>
</div><!-- fragment --><p>Example using an Element instance</p>
<div class="fragment"><div class="line">use <a class="code" href="dd/df5/classTBela_1_1CSS_1_1Ast_1_1Traverser.html">TBela\CSS\Ast\Traverser</a>;</div>
<div class="line">use <a class="code" href="d8/d8b/classTBela_1_1CSS_1_1Parser.html">TBela\CSS\Parser</a>;</div>
<div class="line">use <a class="code" href="df/d08/classTBela_1_1CSS_1_1Renderer.html">TBela\CSS\Renderer</a>;</div>
<div class="line"> </div>
<div class="line">$parser = (<span class="keyword">new</span> Parser())-&gt;load(<span class="stringliteral">&#39;ast/media.css&#39;</span>);</div>
<div class="line">$traverser = <span class="keyword">new</span> Traverser();</div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer([<span class="stringliteral">&#39;remove_empty_nodes&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line"> </div>
<div class="line">$element = $parser-&gt;parse();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// remove @media print</span></div>
<div class="line">$traverser-&gt;on(<span class="stringliteral">&#39;enter&#39;</span>, <span class="keyword">function</span> ($node) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ($node-&gt;type == <span class="stringliteral">&#39;AtRule&#39;</span> &amp;&amp; $node-&gt;name == <span class="stringliteral">&#39;media&#39;</span> &amp;&amp; $node-&gt;value == <span class="stringliteral">&#39;print&#39;</span>) {</div>
<div class="line"> </div>
<div class="line">        return Traverser::IGNORE_NODE;</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">$newElement = $traverser-&gt;traverse($element);</div>
<div class="line">echo $renderer-&gt;renderAst($newElement);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Build a CSS Document</h2>
<div class="fragment"><div class="line">use \TBela\CSS\Element\Stylesheet;</div>
<div class="line"> </div>
<div class="line">$stylesheet = <span class="keyword">new</span> Stylesheet();</div>
<div class="line"> </div>
<div class="line">$rule = $stylesheet-&gt;addRule(<span class="stringliteral">&#39;div&#39;</span>);</div>
<div class="line"> </div>
<div class="line">$rule-&gt;addDeclaration(<span class="stringliteral">&#39;background-color&#39;</span>, <span class="stringliteral">&#39;white&#39;</span>);</div>
<div class="line">$rule-&gt;addDeclaration(<span class="stringliteral">&#39;color&#39;</span>, <span class="stringliteral">&#39;black&#39;</span>);</div>
<div class="line"> </div>
<div class="line">echo $stylesheet;</div>
</div><!-- fragment --><p>output</p>
<div class="fragment"><div class="line">div {</div>
<div class="line">  background-color: #fff;</div>
<div class="line">  color: #000;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">$media = $stylesheet-&gt;addAtRule(<span class="stringliteral">&#39;media&#39;</span>, <span class="stringliteral">&#39;print&#39;</span>);</div>
<div class="line">$media-&gt;append($rule);</div>
</div><!-- fragment --><p>output</p>
<div class="fragment"><div class="line">@media print {</div>
<div class="line">  div {</div>
<div class="line">    background-color: #fff;</div>
<div class="line">    color: #000;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">$div = $stylesheet-&gt;addRule(<span class="stringliteral">&#39;div&#39;</span>);</div>
<div class="line"> </div>
<div class="line">$div-&gt;addDeclaration(<span class="stringliteral">&#39;max-width&#39;</span>, <span class="stringliteral">&#39;100%&#39;</span>);</div>
<div class="line">$div-&gt;addDeclaration(<span class="stringliteral">&#39;border-width&#39;</span>, <span class="stringliteral">&#39;0px&#39;</span>);</div>
</div><!-- fragment --><p>output</p>
<div class="fragment"><div class="line">@media print {</div>
<div class="line">  div {</div>
<div class="line">    background-color: #fff;</div>
<div class="line">    color: #000;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">div {</div>
<div class="line">  max-width: 100%;</div>
<div class="line">  border-width: 0;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">$media-&gt;append($div);</div>
</div><!-- fragment --><p>output</p>
<div class="fragment"><div class="line">@media print {</div>
<div class="line">  div {</div>
<div class="line">    background-color: #fff;</div>
<div class="line">    color: #000;</div>
<div class="line">  }</div>
<div class="line">  div {</div>
<div class="line">    max-width: 100%;</div>
<div class="line">    border-width: 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">$stylesheet-&gt;insert($div, 0);</div>
</div><!-- fragment --><p>output</p>
<div class="fragment"><div class="line">div {</div>
<div class="line">  max-width: 100%;</div>
<div class="line">  border-width: 0;</div>
<div class="line">}</div>
<div class="line">@media print {</div>
<div class="line">  div {</div>
<div class="line">    background-color: #fff;</div>
<div class="line">    color: #000;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Adding existing css </p><div class="fragment"><div class="line"><span class="comment">// append css string</span></div>
<div class="line">$stylesheet-&gt;appendCss($css_string);</div>
<div class="line"><span class="comment">// append css file</span></div>
<div class="line">$stylesheet-&gt;append(<span class="stringliteral">&#39;style/main.css&#39;</span>);</div>
<div class="line"><span class="comment">// append url</span></div>
<div class="line">$stylesheet-&gt;append(<span class="stringliteral">&#39;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css&#39;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Performance</h2>
<p>parsing and rendering ast is 3x faster than parsing an element.</p>
<div class="fragment"><div class="line">use \TBela\CSS\Element\Parser;</div>
<div class="line">use \TBela\CSS\Element\Renderer;</div>
<div class="line"> </div>
<div class="line">$parser = <span class="keyword">new</span> Parser($css);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// parse and render</span></div>
<div class="line">echo (<span class="keywordtype">string</span>) $parser;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// or render minified css</span></div>
<div class="line">$renderer = <span class="keyword">new</span> Renderer([<span class="stringliteral">&#39;compress&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line">echo $renderer-&gt;renderAst($parser-&gt;getAst());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// slower - will build an Element</span></div>
<div class="line">echo $renderer-&gt;render($parser-&gt;parse());</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Parser Options</h2>
<ul>
<li>flatten_import: process @import directive and import the content into the css document. default to false.</li>
<li>allow_duplicate_rules: allow duplicated rules. By default, duplicate rules except @font-face are merged</li>
<li>allow_duplicate_declarations: allow duplicated declarations in the same rule.</li>
<li>capture_errors: silently capture parse error if true, otherwise throw a parse exception. Default to true</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Renderer Options</h2>
<ul>
<li>remove_comments: remove comments.</li>
<li>preserve_license: preserve comments starting with '/*!'</li>
<li>compress: minify output, will also remove comments</li>
<li>remove_empty_nodes: do not render empty css nodes</li>
<li>compute_shorthand: compute shorthand declaration</li>
<li>charset: preserve @charset. default to false</li>
<li>glue: the line separator character. default to '<br  />
'</li>
<li>indent: character used to pad lines in css, default to a space character</li>
<li>convert_color: convert colors to a format between <em>hex</em>, <em>hsl</em>, <em>rgb</em>, <em>hwb</em> and <em>device-cmyk</em></li>
<li>css_level: produce <a class="el" href="d6/ded/namespaceCSS.html">CSS</a> color level 3 or 4. default to <em>4</em></li>
<li>allow_duplicate_declarations: allow duplicate declarations.</li>
<li>legacy_rendering: convert nesting css. default false</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Command line utility</h2>
<p>the command line utility is located at './cli/css-parser'</p>
<div class="fragment"><div class="line">$ ./cli/css-parser -h</div>
<div class="line"> </div>
<div class="line">Usage: </div>
<div class="line">$ css-parser [OPTIONS] [PARAMETERS]</div>
<div class="line"> </div>
<div class="line">-h  print help</div>
<div class="line">--help  print extended help</div>
<div class="line"> </div>
<div class="line">parse options:</div>
<div class="line"> </div>
<div class="line">-e, --capture-errors                        ignore parse error</div>
<div class="line"> </div>
<div class="line">-f, --file                                  css file or url</div>
<div class="line"> </div>
<div class="line">-m, --flatten-import                        process @import</div>
<div class="line"> </div>
<div class="line">-d, --parse-allow-duplicate-declarations    allow duplicate declaration</div>
<div class="line"> </div>
<div class="line">-p, --parse-allow-duplicate-rules           allow duplicate rule</div>
<div class="line"> </div>
<div class="line">render options:</div>
<div class="line"> </div>
<div class="line">-a, --ast                           dump ast as JSON</div>
<div class="line"> </div>
<div class="line">-S, --charset                       remove @charset</div>
<div class="line"> </div>
<div class="line">-c, --compress                      minify output</div>
<div class="line"> </div>
<div class="line">-u, --compute-shorthand             compute shorthand properties</div>
<div class="line"> </div>
<div class="line">-l, --css-level                     css color module</div>
<div class="line"> </div>
<div class="line">-G, --legacy-rendering              legacy rendering</div>
<div class="line"> </div>
<div class="line">-o, --output                        output file name</div>
<div class="line"> </div>
<div class="line">-L, --preserve-license              preserve license comments</div>
<div class="line"> </div>
<div class="line">-C, --remove-comments               remove comments</div>
<div class="line"> </div>
<div class="line">-E, --remove-empty-nodes            remove empty nodes</div>
<div class="line"> </div>
<div class="line">-r, --render-duplicate-declarations render duplicate declarations</div>
<div class="line"> </div>
<div class="line">-s, --sourcemap                     generate sourcemap, require -o</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md14"></a>
Minify inline css</h3>
<div class="fragment"><div class="line">$ ./cli/css-parser &#39;a, div {display:none} b {}&#39; -c</div>
<div class="line">#</div>
<div class="line">$ echo &#39;a, div {display:none} b {}&#39; | ./cli/css-parser -c</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md15"></a>
Minify css file</h3>
<div class="fragment"><div class="line">$ ./cli/css-parser -f nested.css -c</div>
<div class="line">#</div>
<div class="line">$ ./cli/css-parser -f &#39;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css&#39; -c</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md16"></a>
Dump ast</h3>
<div class="fragment"><div class="line">$ ./cli/css-parser -f nested.css -f &#39;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css&#39; -c -a</div>
<div class="line">#</div>
<div class="line">$ ./cli/css-parser &#39;a, div {display:none} b {}&#39; -c -a</div>
<div class="line">#</div>
<div class="line">$ echo &#39;a, div {display:none} b {}&#39; | ./cli/css-parser -c -a</div>
</div><!-- fragment --><p>The full <a href="https://tbela99.github.io/css">documentation</a> can be found <a href="https://tbela99.github.io/css">here</a></p>
<hr  />
<p>Thanks to <a href="https://jetbrains.com">Jetbrains</a> for providing a free PhpStorm license</p>
<p>This was originally a PHP port of <a href="https://github.com/reworkcss/css">https://github.com/reworkcss/css</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassTBela_1_1CSS_1_1Parser_html"><div class="ttname"><a href="d8/d8b/classTBela_1_1CSS_1_1Parser.html">TBela\CSS\Parser</a></div><div class="ttdef"><b>Definition:</b> Parser.php:24</div></div>
<div class="ttc" id="aclassTBela_1_1CSS_1_1Ast_1_1Traverser_html"><div class="ttname"><a href="dd/df5/classTBela_1_1CSS_1_1Ast_1_1Traverser.html">TBela\CSS\Ast\Traverser</a></div><div class="ttdef"><b>Definition:</b> Traverser.php:13</div></div>
<div class="ttc" id="aclassTBela_1_1CSS_1_1Renderer_html"><div class="ttname"><a href="df/d08/classTBela_1_1CSS_1_1Renderer.html">TBela\CSS\Renderer</a></div><div class="ttdef"><b>Definition:</b> Renderer.php:20</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
